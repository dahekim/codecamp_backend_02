<!DOCTYPE html>
<html lang="ko">
<head>
    <title> ğŸ’° ê²°ì œ í˜ì´ì§€ ğŸ’° </title>
    <!-- Axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- JQuery -->
    <script 
    type="text/javascript" 
    src="https://code.jquery.com/jquery-1.12.4.min.js" 
    ></script>
    <!-- iamport.payment.js -->
    <script 
    type="text/javascript" 
    src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"
    ></script>
    
    <script>
        function requestPay() {
            const myAmount = document.getElementById("cost").value

            const IMP = window.IMP; // ìƒëµ ê°€ëŠ¥
            IMP.init("imp06220931"); // Example: imp00000000    
            // IMP.request_pay(param, callback) ê²°ì œì°½ í˜¸ì¶œ
            IMP.request_pay({ 
                
                // param
                pg: "html5_inicis",
                pay_method: "card",
                // merchant_uid: "ORD20180131-0000011", // ìƒëµì‹œ ìë™ìœ¼ë¡œ uid ìƒì„±
                name: "ë…¸ë¥´ì›¨ì´ íšŒì „ ì˜ì",
                amount: myAmount,
                buyer_email: "gildong@gmail.com",
                buyer_name: "í™ê¸¸ë™",
                buyer_tel: "010-4242-4242",
                buyer_addr: "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ì‹ ì‚¬ë™",
                buyer_postcode: "01181"
            }, 
            function (rsp) { 
                // callback
                if (rsp.success) { // ê²°ì œ ì„±ê³µ ì‹œ ë™ì‘í•˜ëŠ” ë¡œì§,ë°±ì—”ë“œì— ë°ì´í„°ë¥¼ ë„˜ê²¨ì¤Œ,
                    console.log(rsp)
                    axios.post(
                        "http://localhost:3000/graphql",
                        {
                            query:`
                            mutation {
                                createPointTransaction(impUid: "${rsp.imp_uid}", amount: ${rsp.paid_amount} ){
                                    id
                                }
                            }
                            `
                        }, {
                            headers:{
                                Authorization: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImtpbWRyZThAbmF2ZXIuY29tIiwic3ViIjoiYzQ5OTJhNmQtOWJmMS00ZTZkLWEwNTMtMDViOWZkMmJjZTQxIiwiaWF0IjoxNjQ5OTI3NzgwLCJleHAiOjE2NDk5MzEzODB9.Hyn-tmxvjtIc0MPRzUT33MGgWpPn8K83TQJUNtmwHeg" // íšŒì›ê°€ì…í•˜ê³  ë¡œê·¸ì¸í•˜ê³  ë°›ì€ í† í° ì£¼ì…
                            }
                        })// í•´ë‹¹ ì—”ë“œ í¬ì¸íŠ¸ ì£¼ì†Œ
                
                } else { // ê²°ì œ ì‹¤íŒ¨ ì‹œ ë¡œì§, ì•Œë¦¼ì°½ ë„ìš°ê¸° 
                    alert("ê²°ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
                }
            });
        }
    </script>
</head>
<body>
    ê²°ì œí•  ê¸ˆì•¡ : <input type="text" id="cost" />
    <button onclick="requestPay()"> ê²°ì œí•˜ê¸° </button>
</body>
</html>