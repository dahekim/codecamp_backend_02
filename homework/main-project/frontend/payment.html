<!DOCTYPE html>
<html lang="en">
    <head>
        <title>ğŸ’° ê²°ì œí•˜ê¸° ğŸ’°</title>
        <!-- JQuery -->
        <script
        type="text/javascript"
        src="https://code.jquery.com/jquery-1.12.4.min.js"
        ></script>
        <!-- iamport.payment.js -->
        <script
        type="text/javascript"
        src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"
        ></script>
        <!-- Axios -->
        <script
        type="text/javascript"
        src="https://unpkg.com/axios/dist/axios.min.js"
        ></script>
        <script>
        function mypayment() {
            const myAmount = Number(document.getElementById("amount").value);
            const IMP = window.IMP; // ìƒëµ ê°€ëŠ¥
            IMP.init("imp06220931"); // Example: imp00000000

            IMP.request_pay({ // param
                pg: "html5_inicis",
                pay_method: "card",
                name: "ë§ˆìš°ìŠ¤",
                amount: myAmount,
                buyer_email: "gildong@gmail.com",
                buyer_name: "í™ê¸¸ë™",
                buyer_tel: "010-4242-4242",
                buyer_addr: "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ì‹ ì‚¬ë™",
                buyer_postcode: "01181",
                m_redirect_url: "", // ëª¨ë°”ì¼ ê²°ì œí›„ ë¦¬ë‹¤ì´ë ‰íŠ¸ë  ì£¼ì†Œ!!
            },
            async (rsp) => {
            // callback
            if (rsp.success) {// / ê²°ì œ ì„±ê³µ ì‹œ ë™ì‘í•˜ëŠ” ë¡œì§,ë°±ì—”ë“œì— ë°ì´í„°ë¥¼ ë„˜ê²¨ì¤Œ,
                console.log(rsp);
                const data = await axios.post(
                    "http://localhost:3000/graphql",
                    {
                        query: `
                        mutation {
                            createPointTransaction(impUid: "${rsp.imp_uid}", amount: ${rsp.paid_amount}) { id }
                        }
                    `,
                },
                {
                    headers: {
                    authorization: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImFAYS5jb20iLCJzdWIiOiJhNjY2Njc1YS02MjQ3LTQ2NjktYTQyYy1jNjk4MDQwNWIwODUiLCJpYXQiOjE2NDQwNDgxNTksImV4cCI6MTY0NDA1MTc1OX0.zFC8DbpzQQbCvgGqCfQ05aknU-IkNEIAKyM4uflp9Mc"
                }
                });
                console.log(data);
            } else { // ê²°ì œ ì‹¤íŒ¨ì‹œ
                alert("ê²°ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
            }
        });
    }
    </script>
    </head>
    <body>
    ê²°ì œí•  ê¸ˆì•¡: <input type="text" id="amount" />
    <button onclick="mypayment()">ê²°ì œí•˜ê¸°</button>
</body>
</html>